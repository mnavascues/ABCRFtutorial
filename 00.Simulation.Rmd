---
#############################################################
#                                                           #
# Click on "Run Document" in RStudio to run this worksheet. #
#                                                           #
#############################################################
title: "Quick Introduction to Simulation"
author: "Miguel de Navascu√©s"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
```

## What is a simulation?

Discuss:

- What is a computer simulation?
- What are the sources of randomness?
- How are random numbers produced in a computer?

## Simulation of a coin toss

### Exercise 1

Simulate a ten coin tosses ($n=10$) using R function `sample(_____)` and probability of getting head $p$. Use a seed for random number generator so your simulation is reproducible:


```{r simulation_coin_toss, exercise=TRUE, exercise.lines=5}
n <- 10
p <- 0.5
coin_toss <- sample(x=c("H","T"),size=_____, replace=_____, prob=_____)
coin_toss
```

```{r simulation_coin_toss-hint}
n <- 10
p <- 0.5
coin_toss <- sample(x=c("H","T"),size=n, replace=T, prob=c(p,1-p))
coin_toss
```

```{r simulation_coin_toss-solution}
set.seed(123456)
n <- 10
p <- 0.5
coin_toss <- sample(x=c("H","T"),size=n, replace=T, prob=c(p,1-p))
coin_toss
```

### Exercise 2

Simulate directly the number of heads ($h'$) using `rbinom(_____)`:

```{r simulation_coin_toss_rbinom, exercise=TRUE}
n <- 10
p <- 0.5
num_of_sim = 1
h_prime <- rbinom(n=_____,size=_____,prob=_____)
h_prime
```

```{r simulation_coin_toss_rbinom-solution}
n <- 10
p <- 0.5
num_of_sim = 1
h_prime <- rbinom(n=num_of_sim,size=n,prob=p)
h_prime
```



## Simulation of population genetic data

Simulation via the coalescent. For convenience, we will use the R package `phyclust` that includes a version of coalescent simulator ms in this tutorial. In practice, use of other simulators (msprime, fastsimcoal or the original implementation of ms) is recommended.

```{r eval=TRUE, echo=TRUE}
library("phyclust", quietly=T)
```

### Exercise 3

Simulate with `ms(_____)` a sample of $n=10$ individuals sequenced for a mitochondrial DNA locus of lenght $l=10000$bp in a population of size $N=10000$ with mutation rate (per bp) $\mu=10^{-8}$:

```{r coalescent_sim, exercise=TRUE}
n<-10
l<-10000
N<-10000
u<-1e-8
num_of_sim<-1
_____
ms(nsam=_____,nreps=_____,opt=_____)
```

```{r coalescent_sim-hint}
n<-10
l<-10000
N<-10000
u<-1e-8
num_of_sim<-1
theta <- _____
ms(nsam=_____,nreps=_____,opt=paste("-t",theta))
```


```{r coalescent_sim-solution}
n<-10
l<-10000
N<-10000
u<-1e-8
num_of_sim<-1
theta <- 2*N*u*l # note that l*u is an approximation!
ms(nsam=n,nreps=num_of_sim,opt=paste("-t",theta))
```

We can put this text into a more usable form (i.e. matrix of polymorphisms, etc) using a function distributed with the original software ms:

```{r eval=TRUE, echo=TRUE}
source("readms.output.R", local =T)
```

### Exercise 4

Use `read.ms.output(_____)` function to read ms output and print only the genotype matrix (i.e. `gametes`).

```{r coalescent_sim_segsites, exercise=TRUE}
n<-10
l<-10000
N<-10000
u<-1e-8
num_of_sim<-1
theta <- 2*N*u*l 
msout <- ms(nsam=n,nreps=num_of_sim,opt=paste("-t",theta))
sim_data <- read.ms.output(____)
_____
```

```{r coalescent_sim_segsites-hint}
n<-10
l<-10000
N<-10000
u<-1e-8
num_of_sim<-1
theta <- 2*N*u*l 
msout <- ms(nsam=n,nreps=num_of_sim,opt=paste("-t",theta))
sim_data <- read.ms.output(txt=msout)
sim_data$_____
```



```{r coalescent_sim_segsites-solution}
n<-10
l<-10000
N<-10000
u<-1e-8
num_of_sim<-1
theta <- 2*N*u*l
msout <- ms(nsam=n,nreps=num_of_sim,opt=paste("-t",theta))
sim_data <- read.ms.output(txt=msout)
sim_data$gametes
```




